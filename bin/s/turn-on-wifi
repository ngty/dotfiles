#!/bin/bash

DIR=`dirname $0`/../../etc/network
source $DIR/devices

CONF=/tmp/`whoami`/wifi.conf

sudo rfkill unblock wifi
sudo ip link set $DEV up

if [[ -n "$1" ]]; then
  CONF=${DIR}/wpa/${1}
else
  [[ -d `dirname $CONF` ]] || mkdir `dirname $CONF`

  echo "ctrl_interface=/var/run/wpa_supplicant" > $CONF
  echo "update_config=1"                       >> $CONF
  echo ""                                      >> $CONF
  cat $DIR/wpa/*                               >> $CONF
fi

sudo wpa_supplicant -i $DEV -c $CONF -B
sudo wpa_cli -B
sudo dhcpcd -d $DEV

# __END__
